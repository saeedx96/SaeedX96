name: Update Daily Quote üìú

on:
  schedule:
    # Har minute run hoga testing ke liye
    - cron: '* * * * *'
  # Isko manually bhi run karne ka option
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update_readme_with_quote:
    name: Update README with a new quote
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository üõéÔ∏è
        uses: actions/checkout@v4

      - name: Setup Python üêç
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies üì¶
        run: pip install requests

      - name: Fetch Quote & Update README ‚úçÔ∏è
        run: |
          import requests
          import re

          try:
            # API se quote fetch karein
            response = requests.get("https://tsunquotes.tsunstudio.pw/api/quotes")
            response.raise_for_status()
            data = response.json()
            quote = data.get("quote", "Could not fetch a quote today.")
            author = data.get("author", "Unknown")
            
            # --- YEH SECTION BADAL DIYA GAYA HAI (THIS SECTION HAS BEEN CHANGED) ---
            # HTML string ko line-by-line banayein taake YAML error na aye
            html_line_1 = '<div align="center">'
            html_line_2 = '  <h3>‚ú® Quote of the Day ‚ú®</h3>'
            html_line_3 = f'  <p><em>"{quote}"</em></p>'
            html_line_4 = f'  <p><strong>‚Äî {author}</strong></p>'
            html_line_5 = '</div>'
            new_quote_html = "\n".join([html_line_1, html_line_2, html_line_3, html_line_4, html_line_5])
            # --- CHANGE ENDS HERE ---

            # README file read karein
            with open("README.md", "r", encoding="utf-8") as file:
                content = file.read()

            # Markers ke beech ka content replace karein
            start_marker = "<!--START_QUOTE_SECTION-->"
            end_marker = "<!--END_QUOTE_SECTION-->"
            
            updated_content = re.sub(f"({re.escape(start_marker)})(.*?)({re.escape(end_marker)})", f"\\1\n{new_quote_html}\n\\3", content, flags=re.DOTALL)

            # README file mein wapis write karein
            with open("README.md", "w", encoding="utf-8") as file:
                file.write(updated_content)
            
            print("README updated successfully!")

          except requests.exceptions.RequestException as e:
            print(f"Error fetching quote: {e}")

        shell: python

      - name: Commit and Push Changes üöÄ
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üìù Chore: Updated daily quote"
          branch: main
          file_pattern: README.md
