name: Update Daily Quote ğŸ“œ

on:
  schedule:
    # Roz raat 12 baje UTC (subah 5 baje PKT) run hoga
    - cron: '0 0 * * *'
  # Isko manually bhi run karne ka option
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update_readme_with_quote:
    name: Update README with a new quote
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository ğŸ›ï¸
        uses: actions/checkout@v4

      - name: Setup Python ğŸ
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies ğŸ“¦
        run: pip install requests

      - name: Fetch Quote & Update README âœï¸
        run: |
          import requests
          import re

          try:
            # API se quote fetch karein
            response = requests.get("https://tsunquotes.tsunstudio.pw/api/quotes")
            response.raise_for_status() # Agar koi error ho to ruk jaye
            data = response.json()
            quote = data.get("quote", "Could not fetch a quote today.")
            author = data.get("author", "Unknown")
            
            # Naya quote HTML format mein tayyar karein
            new_quote_html = f'''<div align="center">
  <h3>âœ¨ Quote of the Day âœ¨</h3>
  <p><em>"{quote}"</em></p>
  <p><strong>â€” {author}</strong></p>
</div>'''

            # README file read karein
            with open("README.md", "r", encoding="utf-8") as file:
                content = file.read()

            # Markers ke beech ka content replace karein
            start_marker = "<!--START_QUOTE_SECTION-->"
            end_marker = "<!--END_QUOTE_SECTION-->"
            
            updated_content = re.sub(f"({re.escape(start_marker)})(.*?)({re.escape(end_marker)})", f"\\1\n{new_quote_html}\n\\3", content, flags=re.DOTALL)

            # README file mein wapis write karein
            with open("README.md", "w", encoding="utf-8") as file:
                file.write(updated_content)
            
            print("README updated successfully!")

          except requests.exceptions.RequestException as e:
            print(f"Error fetching quote: {e}")

        shell: python

      - name: Commit and Push Changes ğŸš€
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ“ Chore: Updated daily quote"
          branch: main # Agar apki main branch 'master' hai to isko 'master' kar dein
          file_pattern: README.md
